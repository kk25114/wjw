# 身份证号码统一转换方案

## 一、项目背景
由于历史原因，我国公民身份证号码存在15位和18位两种格式。为了数据统一和后续处理方便，需要将系统中的15位身份证号码统一转换为18位格式。

## 二、涉及数据表
1. 考生基本信息表（ods_kw_candidate_t）
2. 考场座位信息表（ods_kw_seatinfo_t）
3. 考生信息表（ods_pf_examinee_t）

## 三、转换规则
### 1. 字段说明
- 原字段：`cardno`（原始身份证号）
- 新字段：`cardno_unique`（统一后的18位身份证号）

### 2. 转换规则
1. 18位身份证号：保持不变
2. 15位身份证号转换规则：
   - 前6位：行政区划代码保持不变
   - 年份：增加"19"前缀（如：78年 → 1978年）
   - 月日：保持不变（第7-12位）
   - 顺序码：保持不变（第13-15位）
   - 校验位：补"0"

### 3. 示例
```
15位号码：320106780203015
转换后18位：320106197802030150

18位号码：320106198005200210
转换后18位：320106198005200210
```

## 四、实现代码
```sql
-- 1. 添加新字段
ALTER TABLE ods_kw_candidate_t ADD COLUMNS (cardno_unique string COMMENT '统一18位身份证号');

-- 2. 数据转换
INSERT OVERWRITE TABLE ods_kw_candidate_t PARTITION(ymonth)
SELECT 
    candidate_id,
    -- 其他原有字段...
    cardno,
    CASE 
        WHEN length(cardno) = 18 THEN cardno
        WHEN length(cardno) = 15 THEN 
            concat(
                substring(cardno, 1, 6),    -- 地区码
                '19',                       -- 年份前缀
                substring(cardno, 7, 9),    -- 年月日后8位
                '0'                         -- 校验位
            )
        ELSE cardno                        -- 其他情况保持不变
    END as cardno_unique,
    ymonth
FROM ods_kw_candidate_t;
```

## 五、执行注意事项
### 1. 执行前准备
- 备份相关表的数据
- 检查系统磁盘空间是否充足
- 选择业务低峰期执行

### 2. 执行步骤
1. 先在测试环境执行并验证
2. 执行前先备份数据
3. 按表依次执行转换
4. 执行后数据验证

### 3. 风险点
- 大表数据转换耗时较长
- INSERT OVERWRITE 操作会重写整个表
- 分区表需要注意分区字段的处理

## 六、数据验证方案
1. 数据完整性检查
   - 检查记录总数是否一致
   - 检查关键字段是否完整

2. 数据准确性检查
   - 抽样检查转换后的身份证号
   - 验证15位转18位的准确性

3. 异常数据处理
   - 记录非15位和18位的异常数据
   - 建立异常数据处理机制

## 七、后续建议
1. 技术优化
   - 实现真实的校验位计算
   - 优化转换性能
   - 建立数据质量监控机制

2. 业务建议
   - 使用新字段（cardno_unique）替代原字段
   - 建立身份证号码规范化机制
   - 完善数据质量管理制度

## 八、维护说明
1. 定期检查数据一致性
2. 建立数据问题反馈机制
3. 记录数据更新日志
4. 保持文档的及时更新

## 九、联系人
- 技术负责人：[姓名]
- 业务负责人：[姓名]
- 执行人员：[姓名]

## 十、更新记录
| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|----------|--------|
| V1.0 | YYYY-MM-DD | 初始版本 | [姓名] | 